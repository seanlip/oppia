name: Checks CI Test Suites To Run
description: Computes which CI test suites to run
inputs:
  event_name:
    required: true
    type: string
outputs:
  test_suites_to_run:
    value: ${{ steps.check_test_suites_to_run.outputs.TEST_SUITES_TO_RUN }}

runs:
  using: composite
  env:
    SHOULD_OUTPUT_ALL_TESTS: ${{ inputs.event_name != 'pull_request' || vars.RUN_SUITES_ON_CHANGED_FILES == 'false' }}
  steps:
    - name: Check test suites to run
      id: check_test_suites_to_run
      # This prints to stdout and also writes the output to ./suites-to-run.json.
      run: >
        echo "TEST_SUITES_TO_RUN=";
        python -m scripts.check_ci_test_suites_to_run
        --github_head_ref="HEAD"
        --github_base_ref="origin/${{ github.event.pull_request.base.ref }}"
        ${{ env.SHOULD_OUTPUT_ALL_TESTS == 'true' && '--output_all_test_suites' || '' }} | tee ./suites-to-run.json
    - name: Upload suites-to-run mapping as a GitHub artifact
      needs: [check_test_suites_to_run]
      uses: actions/upload-artifact@v4
      with:
        name: suites-to-run
        path: suites-to-run.json
    - name: Upload root files mapping as a GitHub artifact
      uses: actions/upload-artifact@v4
      with:
        name: root-files-mapping
        path: root-files-mapping.json
